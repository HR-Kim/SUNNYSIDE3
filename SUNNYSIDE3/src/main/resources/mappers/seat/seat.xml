<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="seat">

	<!-- 검색어 -->
	<sql id="baseCondition">
	<where>
		<choose>
			<when test="'10' == searchDiv">
				BRANCH_ID LIKE '%' || #{searchWord} || '%'
			</when>
			<when test="'20' == searchDiv">
				ROOM_ID LIKE '%' || #{searchWord} || '%'
			</when>
			<when test="'30' == searchDiv">
				SEAT_NUM LIKE '%' || #{searchWord} || '%'
			</when>
			<otherwise></otherwise>
		</choose>
	</where>
	</sql>
	 
	<delete id="do_delete" parameterType="Seat">
		DELETE FROM SEAT WHERE SEAT_NUM = #{seatNum, jdbcType=NUMERIC}
	</delete>
	
	<select id="get_selectOne" parameterType="Seat" resultType="Seat">
		SELECT
			BRANCH_ID as branchId,
		    ROOM_ID as roomId,
			SEAT_NUM as seatNum
		FROM
		    SEAT
		WHERE
		    SEAT_NUM = #{seatNum, jdbcType=NUMERIC}
	</select>
	 
	<select id="do_save" parameterType="Seat">
		INSERT INTO SEAT (
		    BRANCH_ID,
		    ROOM_ID,
		    SEAT_NUM
		) VALUES (
		    #{branchId, jdbcType=VARCHAR},
		    #{roomId, jdbcType=VARCHAR},
		    #{seatNum, jdbcType=NUMERIC}
		)
	</select>
	
	<select id="get_retrieve" parameterType="Search" resultType="Seat">
		SELECT T.RNUM as NUM
			  ,T.BRANCH_ID as branchId
			  ,T.ROOM_ID as roomId
			  ,T.SEAT_NUM as seatNum
		FROM(
		    SELECT ROWNUM AS RNUM, A.*
		    FROM(
		         SELECT *
		         FROM SEAT
		         <include refid="baseCondition"/>
		        )A
		    WHERE CEIL(ROWNUM/ #{pageSize, jdbcType=VARCHAR} ) = #{pageNum, jdbcType=VARCHAR}
		    )T
		ORDER BY 1, 2
	</select>

	<update id="do_update" parameterType="Seat">
		UPDATE SEAT
		SET
			SEAT_NUM = #{seatNum, jdbcType=NUMERIC}
		WHERE BRANCH_ID = #{branchId, jdbcType=VARCHAR}
		AND ROOM_ID = #{roomId, jdbcType=VARCHAR}
	</update>
</mapper>